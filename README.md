# Underwater Blockchain Simulator

## Introduction

Simulator made to simulate blockchain algorithms in underwater settings

## Environmental Variables

These variables control various aspects of the simulation

### Verbose Variables

These variables control whether to print the status of multiple parts of the simulation to the console.

- ALL_LAYERS_VERBOSE - if set to *true*, will print the status of all layers and channels of all nodes, disregarding other variables

- APPLICATION_VERBOSE - if set to *true*, will print the status of the application layer of all nodes
- BLOCKCHAIN_VERBOSE  - if set to *true*, will print the status of the blockchain layer of all nodes
- PHYSICAL_VERBOSE  - if set to *true*, will print the status of the physical layer of all nodes
- CHANNEL_VERBOSE  - if set to *true*, will print the status of the channels of all nodes
- BLOCK_VERBOSE - if set to *true*, will print the status of block operations (creation,etc.)

### Simulation Parameters

- MESSAGE_LIFE_AFTER_ARRIVAL - time in milliseconds after which to erase a message received by a node, counting from the moment it arrived at the node

- MINIMUM_TRANSACTIONS_IN_BLOCK - Minimum number of transactions a block must have before being proposed

### Dashboard Variables

- DASHBOARD_UPDATE_PERIOD - Period in milliseconds of dashboard updates


## Classes

### Node

Represents a node in the simulation.

#### Constructor

> new Node(simulation,name,x,y,z)

- simulation - the simulation the node is part of
- name - the name of the node (for display purposes)
- x - initial position in the x axis
- y - initial position in the y axis
- z - initial position in the z axis


#### Properties
- simulation - the simulation the node is part of
- name - the name of the node (for display purposes)
- protocolList - list of all the protocols the node is implementing. They are order starting with the protovol from the highest level layer (application layer most likely) to the lowest level (physical most likely)
- position - Vec3 that stores the position of the node
- velocity - How fast the node can move
- direction - Vec3 representing the direction the node is facing
- received_messages_buffer - buffer containing all received messages. These messages are erased after MESSAGE_LIFE_AFTER_ARRIVAL milliseconds have elapsed since their arrival
- channels - list of channels the node has access to
- knownNodes - list of other nodes that the node is already aware of

#### Methods

- addProtocol(protocol,index) - adds protocol *protocol* to the protocol list at index *index*. If no index is provided, the protocol is added to the end of the list
- addChannel(channel) - adds a channel to the list of available channels to the node
- addKnownNode(node) - adds *node* to the list of known nodes
- sendMessage(content,receiver) - creates a Message object with the content *content* and destination *receiver* and sends it to the first layer (calls its sendMessage function)
- handleMessageReceive(message) - callback function that specifies what the node does when it receives the message *message*
- getRandomKnownNode() - returns a random known node
- draw() - specifies how the node is rendered

#### Static Methods

- getDistance(node1,node2) - returns the distance between *node1* and *node2*



### Message

Represents a Message generated by a node

#### Constructor

> new Message(sender,receiver, content)

- sender - Node that is sending the message
- receiver - Node that will receive the message
- content - Contents of the message. Can be anything, including a string, an array or an object

#### Properties

- sender - Node that is sending the message
- receiver - Node that will receive the message
- content - Contents of the message. Can be anything, including a string, an array or an object
- length - Lenght of the message in bits, including 256 bits for the sender and receiver adresses
- sendingTime - time of message sending
- arrivalTime - time of message arrival




### Channel

A physical channel that a node may use to communicate. A channel is used by only one node

#### Constructor

> new Channel(node,name,propagation_speed,transfer_speed,message_error_ratio,max_distance)

- node - node that is going to use that channel
- name - channel's name (for display purposes)
- propagation_speed - speed in m/s that the messages will travel at
- transfer_speed - speed in bits/s that the messagew will be transfered to the channel
- message_error_ratio - function that takes a paramenter *distance* and returns a message_error_ratio depending on that distance
- max_distance - a distance in m from which it is assumed that there is no communication and the messages are simply dropped


#### Properties

- node - node that is going to use that channel
- name - channel's name (for display purposes)
- propagation_speed - speed in m/s that the messages will travel at
- transfer_speed - speed in bits/s that the messagew will be transfered to the channel
- message_error_ratio - function that takes a paramenter *distance* and returns a message_error_ratio depending on that distance
- max_distance - a distance in m from which it is assumed that there is no communication and the messages are simply dropped

#### Methods

- sendMessage(message) - will send a message through this channel with a delay calculated from the channel's characteristics. When the delay has elapsed, the receiving node's handleMessageReceive callback function will be called. Returns true if success or false in case of failure of transmission


### Protocol

A protocol that takes messages from an upper protocol and sends them to a lower protocol

#### Constructor

>new Protocol(node,layer,protocolPosition,sendMessage,handleMessageReceive)

Automatically adds the protocol to the node's protocolList at *protocolPosition*

- node - node that has this protocol instance
- layer - corresponding layer of this protocol
- sendMessage - function that handles the sending of a message at this layer.
- handleMessageReceive - handles the reception of a message at this layer
- higher_protocol - Protocol that is above this one. If null, means it is the top protocol
- lower_protocol - Protocol that is below this one. If null, means it is the bottom protocol

#### Properties

- node - node that has this protocol instance
- layer - corresponding layer of this protocol
- sendMessage - function that handles the sending of a message at this layer.
- handleMessageReceive - handles the reception of a message at this layer
- higher_protocol - Protocol that is above this one. If null, means it is the top protocol
- lower_protocol - Protocol that is below this one. If null, means it is the bottom protocol


### Simulation

Simulation object.

#### Constructor

> new Simulation()

#### Properties

- nodeList - list of nodes of the simulation

#### Methods

- simulate() - run the simulation

- draw () - render the simulation

- getRandomNode() - returns a random node of the simulation


### Camera

A camera that is used to control the view point of the simulation

#### Constructor

> new Camera()

#### Properties

- position - Vec3 containing the position of the camera
- rotation - Vec3 containing the camera's rotation Euler angles
- cameraSpeed - float specifying how fast the camera can move
- cameraAngularSpeed - float specifying how fast the camera can rotate

#### Methods

- moveToCameraPOV() - moves the viewport to the position and rotation of the camera



### Dashboard

Defines an html overlay that gives information about the simulation

#### Constructor

> new Dashboard(simulation)

- simulation - the current simulation

#### Properties

- simulation - the current simulation
- nodeDashboardOpen - whether the dashboard is open or not

[ INCOMPLETE ] 




## Implementations

### Application Layer

#### RandomMessageApplicationProtocol

(Extends Protocol)
Implemented to be used in a simulation where nodes send messages randomly.

### Blockchain Layer

#### BlockchainProtocol

(Extends Protocol)
Implemented to be used in a simulation where Proof of Stake is used. Uses other classes like LocalBlockchain to set up the system.

#### BlockchainProtocolGenesis

(Extends BlockchainProtocol)
Same as BlockchainProtocol except the node that implements this protocol is the genesis node of the blockchain and is repsonsible for generating the genesis block


### Simulation

#### RandomMessageSimulation

(Extends Simulation)

A simulation in which nodes send messages randomly with a PoS algorithm. Has an instance of the dashboard.

### Physical Layer

#### PhysicalProtocol

(extends Protocol)

A physical layer protocol that selects the first available channel to send the message

### Node

#### RandomMessageNode

(Extends Node)
Implements a node that randomly sends messages and implements the PoS algorithm. Uses the RandomMessageApplicationProtocol, BlockchainProtocol and PhysicalProtocol. Moves around randomly by setting a random target position and moving there over and over.



## Auxiliary Components

### Classes

#### Vec3

Represents a 3D vector

##### Contructor

> new Vec3(x,y,z)

- x - the x component of the vector
- y - the y component of the vector
- z - the z component of the vector

##### Properties

- x - the x component of the vector
- y - the y component of the vector
- z - the z component of the vector

##### Methods

- norm() - returns the norm of the vector
- normalize() - resizes the vector to a length of 1. Returns the vector
- resize(length) - resizes the vector to a length *length*. Returns the vector
- distance2(target_vec) - returns the distance to the target_vec (treating this as a 3D point)
- add(target_vec) - adds the target_vec to the vector. Returns the vector

##### Static Methods

- distance(vec1,vec2) - returns the distance between vec1 and vec2 (treating them as points)
- directionVector - returns a newVector that starts in source_vec and ends in target_vec (treating them as points). Can have any norm

### Functions

- disp(text,toggleVariable) - displays the text *text* in the console if *toggleVariable* is true. Works as a conditional console.log

## Author

João Costa - joaoassuncaoecosta@gmail.com


